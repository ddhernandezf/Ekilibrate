@using Kendo.Mvc.UI
@using System.Web.Mvc
@model Ekilibrate.Model.Entity.Administrador.clsProyecto
@{
    ViewBag.Title = "Participantes";
    ViewBag.Description = "Participantes";
    Layout = "~/Views/Shared/_Empty.cshtml";
}

<div class="row">
    @*<div class="col-lg-3 col-sm-6 col-xs-12">
        <div class="databox databox-lg databox-inverted radius-bordered databox-shadowed databox-graded databox-vertical">
            <div class="databox-top no-padding">
                <img src="@Url.Content("../Uploads/Empresas/" + Model.EmpresaId + ".png")" style="width:100%; max-width:200px; max-height:200px;" class="img_empresa">
            </div>
            <div class="databox-bottom no-padding bordered-thick bordered-orange">
                <div class="databox-row">       
                    <div class="d                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               atabox-cell cell-12 no-padding text-align-center bordered-right bordered-platinum">
                        <span class="databox-number lightcarbon no-margin">Empresa:</span>
                        <span class="databox-te xt sonic-silver  no-margin"><label id="EmpresaNombre">@Model.EmpresaNombre</label></span>
                    </div>                    
                </div>
            </div>  
        </div>        
    </div>*@
    <div class="col-lg-6 col-sm-6 col-xs-12">        
            <a onclick="clickEdit(this)">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="col-lg-6 col-md-6 col-sm-6 text-center">
                        <div class="databox databox-lg databox-inverted radius-bordered databox-shadowed databox-graded databox-vertical">
                            <img src="@Url.Content("../Uploads/Empresas/" + Model.EmpresaId + ".png")" style="width:100%; max-width:200px;" class="img_empresa" alt="@Model.EmpresaNombre">
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 profile-info">
                        <label class="col-lg-12 control-label h4"><i class="glyphicon glyphicon-star"></i> Proyecto: @Model.Nombre</label>
                        <div class="col-lg-12">
                            <p>
                                <i class="glyphicon glyphicon-asterisk"></i> No.	: @Model.Id <br>
                                <i class="glyphicon glyphicon-briefcase"></i> Empresa	: @Model.EmpresaNombre <br>
                                <i class="glyphicon glyphicon-tag"></i> Tipo de Proyecto   : @Model.TipoProyecto <br>
                                <i class="glyphicon glyphicon-info-sign"></i> Estado		: @Model.Estado <br>
                                <button type="button" onclick="FinalizarCarga(this)" class="btn-lg btn-success btn-next tooltip-success" data-last="Finish" value="Finalizar" name="accion" data-toggle="tooltip" data-placement="top" data-original-title="Finalizar Carga de Parametrización">Finalizar</button>
                            </p>
                        </div>

                    </div>
                </div>
            </a>
        
    </div>
</div>

    <h4> <label id="EmpresaNombre"></label> </h4>
    <label id="ProyectoId">@Model.Id</label>
    <label id="RoleDescriptionU">Para cargar el listado de participantes por medio de un archivo de Excel (.xls, .xlsx) presione el botón seleccionar y seleccione el archivo</label>
    <label>Descargar Excel de prueba</label><a href="~/Uploads/Participantes/Participantes.xlsx" title='Descargar Excel Ejemplo'><img src='../assets/img/icons/MS Excel-32.png' /></a>


    @(Html.Kendo().Upload()
        .Name("files1")
        .Multiple(false)
        .Messages(x => x.Select("Seleccionar un archivo").UploadSelectedFiles("Cargar"))
        .Events(x => x.Upload("onImageUpload")
                      .Complete("onComplete")
                      .Error("onError"))
        .Async(a => a
            .Save("Submit", "Proyecto")
            .AutoUpload(false)
        )
        //.Validation(validation => validation.AllowedExtensions(new string[] { ".xlsx", ".xls" }))        
    )

    <script type="text/javascript">
        function onError(e) {
            console.log(e);
            var err = e.XMLHttpRequest.responseText;

            if (err.length > 0) {
                alert(err);
            }
            else {
                alert("El archivo de cargó correctamente");
            }
        }

        function onComplete(e) {
            //console.log(e);
            //var err = $.parseJSON(e.XMLHttpRequest.responseText);            
            //if (err.success) {
            //    alert("El archivo de cargó correctamente");
            //}
            //else {
            //    alert(err.error);
            //}
            ////alert("Archivo cargado exitosamente.");
            //$("#gridParticipantes").data("kendoGrid").dataSource.read();
        }

        function ParametroProyecto() {
            //console.log($("#ProyectoId").text());
            return {
                pProyectoId: $("#ProyectoId").text()
            }
        }

        function getFileInfo(e) {
            return $.map(e.files, function (file) {
                var info = file.name;

                // File size is not available in all browsers
                if (file.size > 0) {
                    info += " (" + Math.ceil(file.size / 1024) + " KB)";
                }
                return info;
            }).join(", ");
        }

        function onImageUpload(e) {
            e.data = ParametroProyecto();
        }

        function FinalizarCarga(e) {
            $.ajax({
                url: 'Proyecto/FinalizarCarga?pProyectoId=' + $("#ProyectoId").text(),
                type: 'POST',
                data: {},
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    if (data.success) {
                        alert("Se envió la parametrización del proyecto al administrador correctamente");
                    }
                    else {
                        alert(data.error);
                    }
                },
                error: function () {
                    alert("error");
                }
            });
        }
    </script>

    <div id="divUnAssignedUsers" class="grid-mantenimientos-content-center">
        @(Html.Kendo().Grid<Ekilibrate.Model.Entity.Participante.clsParticipante>()
            .Name("gridParticipantes")
            .Columns(columns =>
            {
                columns.Bound(p => p.Id).Width(25).Title("");
                columns.Bound(p => p.Nombre).Width(175).Title("Nombres");
                columns.Bound(p => p.Apellido).Width(175).Title("Apellidos");
                columns.Bound(p => p.Grupo).Width(175);
                //columns.Command(command =>
                //{
                //    //command.Edit().Text("Actualizar");
                //    //command.Destroy().Text(" ");
                //}).Width(200);
            })
                //.ToolBar(toolbar => toolbar.Create().Text(" "))
            .Editable(editable => editable.Mode(GridEditMode.InCell))
            .Filterable(f =>
            {
                f.Extra(false);
            })
            .Pageable(p =>
            {
                p.Refresh(true);
            })
            .Sortable()
            .Scrollable()
            .HtmlAttributes(new { style = "height:430px;" })
            .DataSource(dataSource => dataSource
                .Ajax()
                .Events(events => events.Error("error_handler"))
                .PageSize(10)
                .Model(model =>
                {
                    model.Id(p => p.Id);
                })
                //.Create(update => update.Action("Create", "Participante"))
                .Read(read => read.Action("Read", "Participante").Data("ParametroProyecto"))
                //.Update(update => update.Action("Update", "Participante"))
                //.Destroy(update => update.Action("Delete", "Participante"))
            )
        )
    </div>
